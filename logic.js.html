<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: logic.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: logic.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>'use strict'
const Shape = require('./curve/shape');
const Grade = require('./curve/grade');
const ReverseGrade = require('./curve/reverse-grade');
const Triangle = require('./curve/triangle');
const Trapezoid = require('./curve/trapezoid');
const Constant = require('./curve/constant');
const FuzzyFunction = require('./curve/fuzzy-function');
const Sigmoid = require('./curve/sigmoid');

const TYPE_INIT = 'init';
const TYPE_AND = 'and';
const TYPE_OR = 'or';
const TYPE_NOT = 'not';

const ruleEngine = {
  and(a, b, value){
    return Math.min(a.fuzzify(value), b.fuzzify(value));
  },
  or(a, b, value) {
    return Math.max(a.fuzzify(value), b.fuzzify(value));
  },
  not(a, b=null, value) {
    return 1 - a.fuzzify(value);
  }
};
/** Class helping with FuzzyLogic. */

class Logic {
  initCalled = false;
  constructor() {
    this.c = {
      Shape,
      Grade,
      ReverseGrade,
      Trapezoid,
      Triangle,
      Constant,
      FuzzyFunction,
      Sigmoid
    };
    this.rules = [];
  }

  checkInitCalled() {
    if (!this.initCalled) {
      throw Error('init needs to be called before performing logic');
    }
  }

  init(output, shape) {
    this.initCalled = true;
    let type = TYPE_INIT;
    this.rules.push({ output, shape, type });
    return this;
  }
  and(output, shape) {
    this.checkInitCalled();
    let type = TYPE_AND;
    this.rules.push({ output, shape, type });
    return this;
  }
  or(output, shape) {
    this.checkInitCalled();
    let type = TYPE_OR;
    this.rules.push({ output, shape, type });
    return this;
  }
  not(output, shape) {
    this.checkInitCalled();
    let type = TYPE_NOT;
    this.rules.push({ output, shape, type });
    return this;
  }
  defuzzify(value) {
    this.checkInitCalled();
    let defuzzified = 'none';
    let fuzzified = 0;
    let lastShape;

    this.rules.forEach(rule => {
      rule.fuzzy = rule.shape.fuzzify(value);
      // lets keep the initial value
  
      if (rule.type === TYPE_INIT) {
        defuzzified = rule.output;
        fuzzified = rule.fuzzy;
        lastShape = rule.shape;
        return;
      } else {
        let fuzzyCompRes = ruleEngine[rule.type](lastShape, rule.shape, value);
        lastShape.fuzzify(value)
        // old value is kept, not is not yet implemented
        if (fuzzyCompRes === lastShape.fuzzify(value)) {
          return;
        }
        defuzzified = rule.output;
        fuzzified = rule.fuzzy;
        // if there is no shape, like for example for a NOT keep the last one
        lastShape = rule.shape ||Â lastShape;
      }
    });
    /**
     *
     * @example  fuzzy.defuzzify(10)
     */
    return {
      fuzzified: fuzzified,
      defuzzified: defuzzified,
      rules: this.rules,
      valueOf() {
        return fuzzified;
      },
      toString() {
        return defuzzified;
      }
    };
  }
}
module.exports = Logic;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Constant.html">Constant</a></li><li><a href="FuzzyFunction.html">FuzzyFunction</a></li><li><a href="Grade.html">Grade</a></li><li><a href="Logic.html">Logic</a></li><li><a href="ReverseGrade.html">ReverseGrade</a></li><li><a href="Shape.html">Shape</a></li><li><a href="Sigmoid.html">Sigmoid</a></li><li><a href="Trapezoid.html">Trapezoid</a></li><li><a href="Triangle.html">Triangle</a></li></ul><h3>Tutorials</h3><ul><li><a href="tutorial-CHANGELOG.html">CHANGELOG</a></li><li><a href="tutorial-glossary.html">glossary</a></li><li><a href="tutorial-manual.html">manual</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.10</a> on Sat Jun 11 2022 22:52:49 GMT+0200 (Central European Summer Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
